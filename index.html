<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Food Menu</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
    crossorigin="anonymous">

</head>

<body>
  <h1>The Food Menu</h1>
  
  <select id="quantity">
    <option value="">Quantity</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
  <select id="size">
    <option value="">Size</option>
    <option value="ounces">Ounces</option>
    <option value="cup">Cup</option>
    <option value="large">Large</option>
  </select>

  <input type="text" placeholder="Put in Food" id="food-name">
  <button id="search-button">Search</button>

  <p>Food: <span id="food"></span></p>
  <p>Calories: <span id="calories"></span></p>
  <p>Carbs: <span id="carbs"></span></p>
  <p>Protein: <span id="protein"></span></p>
  <p>Fat: <span id="fat"></span></p>


  <button id="add-ingredient">Add Ingredient</button>

  <br />
  <br />
  <table class="table" id="ingredients">
    <tr>
      <th>Ingredient</th>
      <th>Calories</th>
    </tr>
  </table>
  <div>Total Ingredients Calories: <span id="total-ingredients-calories"></span></div>

  <button id="find-recipes">Find Recipes</button>

  <table class="table" id="recipes-table">
    <tr>
      <th>Name</th>
      <th>Image</th>
      <th>Total Calories</th>
    </tr>
  </table>

  <!-- <p>Total Calories: <span id="total-calories"></span></p> -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">

    var YOUR_APP_ID = '060d6c07';
    var YOUR_APP_KEY = '4caf8f45e89f735e57b03965c8dc01b8';
    var ingredientsArray= []; //this is to set an empty array that we will push ingredients into
    var ingredientsCaloriesArray = []; // this is an empty array where we will push the num of total calories of each ingredient added.


    $('#search-button').on('click', function () {
      var food = $("#food-name").val();
      var quantity = $("#quantity").val();
      var size = $("#size").val();
      var searchString = quantity + " " + size + " " + food;
      //First AJAX call for food nutritional info
      $.ajax({
        url: `https://api.edamam.com/api/nutrition-data?app_id=${YOUR_APP_ID}&app_key=${YOUR_APP_KEY}&ingr=${searchString}`,
        method: "GET"
      }).then(function (response) {
        console.log(response);
        $('#food').text(food);
        $('#calories').text(Math.round(response.calories));
        $('#carbs').text(response.totalNutrients.CHOCDF.quantity);
        $('#protein').text(response.totalNutrients.PROCNT.quantity);
        $('#fat').text(response.totalNutrients.FAT.quantity);
      });

    });
    //created an add ingredient button and added variable food and calories
    $('#add-ingredient').on('click', function () {
      var food = $('#food').text();
      var calories = parseInt($('#calories').text()); //this is to get the calories in a number to be able to add it up 
      ingredientsCaloriesArray.push(calories) //this adds the calories to the empty array
      // this added both the food name and calories generated by the first search into the add ingredient table

      $("#ingredients").append("<tr><td> " + food + "</td><td> " + Math.round(calories) + "</td></tr>");
      ingredientsArray.push(food); //This adds the ingredients put added to the ingredients array
      var total=0;
      for(var i in ingredientsCaloriesArray) { total += ingredientsCaloriesArray[i]; } //summing up ingredient calories in ingredients calories array

      $('#total-ingredients-calories').text(total); //updating calories to total calories using  the total variable
    });
    //created a button called "add-to-table" and did an on click event to capture the food name put in by users

    $('#find-recipes').on('click', function () {
      var recipeSearch = ingredientsArray.toString(); //added the results of search recipe to the empty array and then converted the array to a string to combine the ingredients and generate a recipe based on ingredients
      //Second AJAX call for recipes data
      $.ajax({
        url: `https://api.edamam.com/search?q=${recipeSearch}&app_id=65b4957f&app_key=2307311a6f68d1a304d10e8552b128ed&to=5`, //the "to=5" limits the number of recipes shown on the page to 5
        method: "GET"
      }).then(function (response) {
        console.log(response.hits);
        //Did a for loop so response can loop through the hits in the array i.e recipes
        for (i = 0; i < response.hits.length; i++) {

          //setting the url to a link tag to make the food name/label clickable
          $('#recipes-table').append(
            `<tr>
              <td><a href="${response.hits[i].recipe.url}">${response.hits[i].recipe.label}</a></td>
              <td><img src="${response.hits[i].recipe.image}"/></td>
              <td>${Math.round(response.hits[i].recipe.calories)}</td>
            </tr>`
          ); //This is a backtick string representing the html for a row and the cells inside the recipe table. Used html link, image and text.

          //$('#recipes-table').append(response.hits[i].recipe.label);  
          // this was initially adding the label name on the page but I made the label name clicakble by adding a link to it so it's no longer neccessary      


          

          //Math.round rounds up (calorie) numbers
          //added text "total calories" to show on page next the calorie amount/number





        }

      });
    });




  </script>
</body>

</html>


<!-- food recipe api
Application ID- 65b4957f
Application key - 2307311a6f68d1a304d10e8552b128ed	 -->

<!-- Need to do 
figure way to add ingredient calories and give total calories
figure a way to find recipes combining chosen ingredients( e.g if user inputs apples and bananas, find recipes that use both banana and apples as ingredients)
Figure out bootstrap alternative
Figure out how to add firebase
MAybe have the recipe link open in a different page
Add a check box next to each element of ingredient ?
for each ingredient checked off, get the value of that element selected and pump that value into the queryURL to find recipes
create a button next to find recipes called find selected ingredients

 -->